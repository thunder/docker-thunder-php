language: bash
services: docker

env:
  - VERSION=7.3 VARIANT=cli

before_script:
  - slash='/'; THUNDER_PHP_IMAGE_TAG="thunder-php:${VERSION}-${VARIANT//$slash/-}"

script:
  - docker build -f $VERSION/$VARIANT/Dockerfile -t "$THUNDER_PHP_IMAGE_TAG" .
  - docker-compose -f $VERSION/$VARIANT/docker-compose.test.yml -p test build
  - docker-compose -f $VERSION/$VARIANT/docker-compose.test.yml -p test up -d
  - travis_wait 20 TEST_RESULT=$(docker wait test_sut_1)
  - |
    (
      if (( $TEST_RESULT != 0 )); then
        exit 1
      fi
    )

after_script:
  - docker images
